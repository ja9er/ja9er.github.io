<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>ä»éªŒè¯ç çˆ†ç ´å¼€å§‹çš„burpæ’ä»¶å­¦ä¹  | Ja9er&#39;s Studio</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://ja9er.github.io/favicon.ico?v=1642402095080">
<link rel="stylesheet" href="https://ja9er.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="ä»éªŒè¯ç çˆ†ç ´å¼€å§‹çš„burpæ’ä»¶å­¦ä¹ 


PSï¼šä»…ä»…ä½œä¸ºå­¦ä¹ ,æ²¡ä»€ä¹ˆç”¨ğŸ˜ƒ

ä¹‹å‰æ”¹äº†ä¸€ä¸ªéªŒè¯ç çˆ†ç ´çš„burpæ’ä»¶ã€‚å°æ”¹äº†å…¶ä»–å¸ˆå‚…çš„ä»£ç ã€‚
ç°åœ¨ä»å¤´å­¦ä¹ ä¸€ä¸‹burpçš„æ’ä»¶å¼€å‘ï¼Œç›®æ ‡æ˜¯å®ç°åœ¨repeateræ¨¡å—çš„ç™»å½•å£è‡ªåŠ¨æ›´æ¢å®æ—¶éªŒè¯ç 
å› ä¸ºp..." />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://ja9er.github.io">
        <img src="https://ja9er.github.io/images/avatar.png?v=1642402095080" class="site-logo">
        <h1 class="site-title">Ja9er&#39;s Studio</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      ç‡ƒçƒ§æ‰æ€»æ¯”æ¶ˆå¤±å¥½
    </div>
    <div class="site-footer">
       | <a class="rss" href="https://ja9er.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">ä»éªŒè¯ç çˆ†ç ´å¼€å§‹çš„burpæ’ä»¶å­¦ä¹ </h2>
            <div class="post-date">2022-01-17</div>
            
              <div class="feature-container" style="background-image: url('https://s4.ax1x.com/2022/01/17/7U4l0H.gif')">
              </div>
            
            <div class="post-content" v-pre>
              <p>ä»éªŒè¯ç çˆ†ç ´å¼€å§‹çš„burpæ’ä»¶å­¦ä¹ </p>
<!-- more -->
<blockquote>
<p>PSï¼šä»…ä»…ä½œä¸ºå­¦ä¹ ,æ²¡ä»€ä¹ˆç”¨ğŸ˜ƒ</p>
</blockquote>
<p>ä¹‹å‰æ”¹äº†ä¸€ä¸ªéªŒè¯ç çˆ†ç ´çš„burpæ’ä»¶ã€‚å°æ”¹äº†å…¶ä»–å¸ˆå‚…çš„ä»£ç ã€‚</p>
<p>ç°åœ¨ä»å¤´å­¦ä¹ ä¸€ä¸‹burpçš„æ’ä»¶å¼€å‘ï¼Œç›®æ ‡æ˜¯å®ç°åœ¨repeateræ¨¡å—çš„ç™»å½•å£è‡ªåŠ¨æ›´æ¢å®æ—¶éªŒè¯ç </p>
<p>å› ä¸ºpythonå¼€å‘æ¯”è¾ƒæ–¹ä¾¿ï¼Œè¿™é‡Œç›´æ¥é€‰pythonã€‚</p>
<h2 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®</h2>
<p>åœ¨extender-Options-PythonEnvironmentä¸­é…ç½®ä½ çš„jython.jaræ–‡ä»¶è·¯å¾„</p>
<p>py2ä¸‹è½½burpåŒ…</p>
<p>ç„¶åå°±å¯ä»¥æ„‰å¿«çš„å¼€å§‹å¼€å‘äº†</p>
<h2 id="å®ç°">å®ç°</h2>
<p>burpæä¾›äº†æ‰€æœ‰APIç›¸å…³<a href="https://portswigger.net/burp/extender/api/index.html">æ–‡æ¡£</a>ä»¥åŠå¼€å‘ç¤ºä¾‹<a href="https://portswigger.net/burp/extender/">demo</a></p>
<p>ä¹‹å‰æ”¹çš„è„šæœ¬æ˜¯çˆ†ç ´æ¨¡å—çš„ï¼Œç°åœ¨å°è¯•æ”¹ä¸€ä¸ªrepeteræ¨¡å—çš„å‡ºæ¥</p>
<p>é€šè¿‡æ–‡æ¡£å’Œdemoé˜…è¯»ï¼Œå‘ç°æ‰€æœ‰çš„æ’ä»¶éƒ½éœ€è¦ç»§æ‰¿IBurpExtenderè¿™ä¸ªç±»</p>
<figure data-type="image" tabindex="1"><a href="https://imgtu.com/i/7U4u6O"><img src="https://s4.ax1x.com/2022/01/17/7U4u6O.png" alt="7U4u6O.png" loading="lazy"></a></figure>
<p>æ‰€ä»¥é¦–å…ˆéœ€è¦ä¸€ä¸ªç±»ç»§æ‰¿ä»–ï¼Œä¹Ÿå°±æ˜¯è¿™æ ·</p>
<pre><code class="language-python">class BurpExtender(IBurpExtender):
</code></pre>
<p>IBurpExtenderç±»é»˜è®¤éœ€è¦registerExtenderCallbackså‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ç”¨æ¥æ³¨å†Œåˆå§‹åŒ–ã€‚Callback æ­¤å˜é‡æ˜¯åœ¨ä¹¦å†™burpæ’ä»¶ä¸­æœ€å¿…ä¸å¯å°‘çš„å˜é‡ï¼Œå¦‚æœä½ éœ€è¦è°ƒç”¨ä½ æ‰€å¯¼å‡ºçš„apiçš„å‡½æ•°çš„è¯ï¼Œå¿…é¡»è¦ç”¨Callbackå…ˆæ³¨å†Œä¸€ä¸‹ï¼Œå¦‚ä¸‹.registxxxxxxæ˜¯å¾…ä¼šå„¿æˆ‘ä»¬è°ƒç”¨çš„å…¶ä»–ç±»çš„æ³¨å†Œæ–¹æ³•ï¼Œè¿™é‡Œæš‚æ—¶ç”¨registxxxxxxæ¥ä»£æ›¿</p>
<pre><code class="language-python">class BurpExtender(IBurpExtender):
	    def registerExtenderCallbacks(self, callbacks):
        	# æ–¹ä¾¿ä¸€ä¼šå„¿è°ƒç”¨
       		self._callbacks = callbacks
       		self._callbacks.registxxxxxx(self)
            # æ’ä»¶é‡Œé¢æ˜¾ç¤ºçš„åå­—
       		callbacks.setExtensionName(&quot;OCR_CAPTCHA_repeter&quot;)
</code></pre>
<p>ç„¶åæˆ‘ä»¬ä¸æ˜¯è¦æ‰¾repeteræ¨¡å—å—ï¼Œåœ¨HTTPæ¶ˆæ¯å¤„ç†æ¥å£ç±»ä¸­å‘ç°IHttpListeneræ¯”è¾ƒç¬¦åˆè¿™ä¸ªé€‰æ‹©,æ‹¦æˆªä»»ä½•burpå·¥å…·å‘å‡ºçš„requestå’Œresponse</p>
<figure data-type="image" tabindex="2"><a href="https://imgtu.com/i/7U4n1K"><img src="https://s4.ax1x.com/2022/01/17/7U4n1K.png" alt="7U4n1K.png" loading="lazy"></a></figure>
<p>å‡½æ•°é•¿è¿™æ ·</p>
<pre><code class="language-java">processHttpMessage(int toolFlag, boolean messageIsRequest, IHttpRequestResponse messageInfo)
This method is invoked when an HTTP request is about to be issued, and when an HTTP response has been received.
</code></pre>
<p>ç¬¬ä¸€ä¸ªå‚æ•°toolFlagåˆ¤æ–­ä»å“ªä¸ªå·¥å…·ä¼ æ¥çš„ï¼Œè¿™ä¸ªå‚æ•°åœ¨IBurpExtenderåˆå§‹åŒ–çš„callbackä¸­ç¡¬ç¼–ç ã€‚å¦‚å›¾,æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­æ˜¯å¦repeaterä¸­ä¼ æ¥å°±è¡Œ</p>
<figure data-type="image" tabindex="3"><a href="https://imgtu.com/i/7U4KXD"><img src="https://s4.ax1x.com/2022/01/17/7U4KXD.png" alt="7U4KXD.png" loading="lazy"></a></figure>
<p>æ˜¾ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨IHttpListenerè¿™ä¸ªç±»äº†ï¼Œæ­¤æ—¶ä»£ç å¦‚ä¸‹,æ³¨å†Œä¸€ä¸ªhttplistenerã€‚ä½¿ç”¨<code>registerHttpListener</code></p>
<pre><code class="language-python">class BurpExtender(IBurpExtender, IHttpListener):

    def registerExtenderCallbacks(self, callbacks):
        # æ–¹ä¾¿ä¸€ä¼šè°ƒç”¨
        self._callbacks = callbacks
        self._callbacks.registerHttpListener(self)
        #helpç±»å¸®åŠ©è§£ææ•°æ®
        self._helpers = callbacks.getHelpers()
        # æ’ä»¶é‡Œé¢æ˜¾ç¤ºçš„åå­—
        callbacks.setExtensionName(&quot;OCR_CAPTCHA_repeter&quot;)
        print(&quot;init success&quot;)
     
</code></pre>
<p>IHttpListenerå…·ä½“çš„å®ç°æ–¹æ³•åœ¨å®ƒçš„processHttpMessageæ–¹æ³•ä¸­ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç»§æ‰¿åè¦å®ç°çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯åˆšåˆšåœ¨æ–‡æ¡£ä¸­çœ‹åˆ°çš„é‚£ä¸ªæ–¹æ³•</p>
<figure data-type="image" tabindex="4"><a href="https://imgtu.com/i/7U4mp6"><img src="https://s4.ax1x.com/2022/01/17/7U4mp6.png" alt="7U4mp6.png" loading="lazy"></a></figure>
<p>å®ç°ä»£ç å¦‚ä¸‹</p>
<pre><code class="language-python">def processHttpMessage(self, toolFlag, messageIsRequest, messageInfo):
      	#toolFlagåˆ¤æ–­ä»REPEATERä¼ æ¥è¯·æ±‚ï¼ŒmessageIsRequestæ˜¯ä¸€ä¸ªå‘ç‚¹éœ€è¦æ³¨æ„ï¼Œå®ƒçš„å€¼ä¸ºæ˜¯å¦å·²ç»å‘å‡ºè¯·æ±‚çš„åˆ¤æ–­ã€‚ä¸åœ¨å®ç°æ–¹æ³•ä¸­åˆ¤æ–­çš„è¯ä¼šå‘å‡ºä¸¤æ¬¡è¯·æ±‚ä»è€Œé€ æˆRequest has already been issuedçš„é”™è¯¯
        if toolFlag == self._callbacks.TOOL_REPEATER and messageIsRequest==1:
            #ä¸Šé¢å¼•å…¥çš„helpç±»è§£æä¼ å…¥çš„ä¿¡æ¯
            analyIRequestInfo = self._helpers.analyzeRequest(messageInfo)
            #è·å–æ•´ä¸ªrequestçš„å†…å®¹
            request = messageInfo.getRequest()
            #è¯·æ±‚bodyå†…å®¹éœ€è¦è®¡ç®—ç¼“å­˜
            body = request[analyIRequestInfo.getBodyOffset():]
            headers = analyIRequestInfo.getHeaders()
            #è·å–requestä¸­æˆ‘ä»¬è‡ªå·±åŠ çš„headerä¸­å­—æ®µå†…å®¹ï¼ŒDDDDOCRè¡¨ç¤ºè¯·æ±‚éªŒè¯ç ç”Ÿæˆçš„url
            DDURL = re.findall(r&quot;DDDDOCR:(.*?)\,&quot;, str(headers))
            if len(DDURL) &gt; 0:
                cookie = re.findall(&quot;Cookie: (.*?)\s&quot;, str(headers))[0]
                #filedä¸ºè‡ªå·±å®šä¹‰çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æ¥è·å–bodyä¸­çš„éªŒè¯ç å‚æ•°çš„å€¼
                filed = re.findall(r&quot;filed:(.*?)\,&quot;, str(headers))[0]
                value = re.findall(filed, body.tostring())[0]#è·å–åˆ°éªŒè¯ç çš„å€¼ï¼Œæ–¹ä¾¿åé¢æ›¿æ¢
                OCR_CAPTCHA_url = DDURL[0]
                requestheaders = {
                    &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36&quot;,
                    &quot;Cookie&quot;: cookie}
                request = urllib2.Request(OCR_CAPTCHA_url, headers=requestheaders)
                ssl._create_default_https_context = ssl._create_unverified_context
                host = ('127.0.0.1', 5000)
                CAPTCHA = urllib2.urlopen(request)  # è·å–å›¾ç‰‡
                CAPTCHA_base64 = base64.b64encode(CAPTCHA.read())  # æŠŠå›¾ç‰‡base64ç¼–ç 
                request = urllib2.Request('http://%s:%s/base64' % host, 'base64=' + CAPTCHA_base64)
                response = urllib2.urlopen(request).read()
                #body.tostring()è½¬ä¸ºå­—ç¬¦ä¸²å½¢å¼ï¼Œtypeä¸ºstrå’Œpythonä¸­ç±»å‹ä¸€è‡´
                data = str(body.tostring()).replace(value, response)
              	#æ„å»ºæ–°çš„è¯·æ±‚æ›¿æ¢åŸæ¥çš„è¯·æ±‚
                newHttpMessage = self._helpers.buildHttpMessage(headers, data)
                messageInfo.setRequest(newHttpMessage)
</code></pre>
<h2 id="æ•ˆæœ">æ•ˆæœ</h2>
<p>è´´ä¸€ä¸ªåç«¯ä»£ç </p>
<pre><code class="language-python">from flask import Flask
from flask import request
import ddddocr
import re, time, base64
app = Flask(__name__)
#è¿”å›æˆ‘ä»¬ä¼ çš„verifyçš„å€¼
@app.route('/test',methods=[&quot;POST&quot;])
def getrequest():
    verify = request.values.get(&quot;verify&quot;)
    return verify
@app.route('/',methods=[&quot;GET&quot;])
def show_image():
    with open('static/log.txt', 'r') as f:
        content = f.read()
    data = '&lt;title&gt;404 NOT FOUND&lt;/title&gt;&lt;body style=&quot;text-align:center&quot;&gt;&lt;h1&gt;éªŒè¯ç è¯†åˆ«&lt;/h1&gt;&lt;p&gt;&lt;TABLE style=&quot;&quot; borderColor=&quot;&quot; height=40 cellPadding=1 align=center border=20&gt;&lt;tr align=center&gt;&lt;td&gt;éªŒè¯ç &lt;/td&gt;&lt;td&gt;è¯†åˆ«ç»“æœ&lt;/td&gt;&lt;td&gt;æ—¶é—´&lt;/td&gt;&lt;/tr&gt;%s&lt;/body&gt;' % (
        content)
    return data

@app.route('/base64',methods=[&quot;POST&quot;])
def ocr():
    count=5
    try:
        base64_img = request.values.get(&quot;base64&quot;)
        img_name = time.time()
        ocr = ddddocr.DdddOcr(show_ad=False)
        base64_img =str(base64_img).replace(' ', '+')
        img_bytes = base64.b64decode(base64_img)
        res = ocr.classification(img_bytes)
        with open('static/log.txt', 'r') as f:
            data = &quot;&quot;
            counts = 0
            content = f.read()
            pattern = re.compile(r'.*?\n')
            result1 = pattern.findall(content)
            for i in result1:
                counts += 1
                if counts &gt;= count: break
                data = data + i
        with open('static/log.txt', 'w+') as f:
            f.write('&lt;tr align=center&gt;&lt;td&gt;&lt;img src=&quot;data:image/png;base64,%s&quot;/&gt;&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;\n' % (
            base64_img, res, time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, time.localtime(int(img_name)))) + data)

        return res
    except Exception as e:
        return &quot;0000&quot;
if __name__ == '__main__':
    app.run()

</code></pre>
<p>éšä¾¿æ‰¾ä¸€ä¸ªéªŒè¯ç ç”Ÿæˆurlä½œä¸ºéªŒè¯ï¼Œå¯ä»¥çœ‹åˆ°è¿”å›çš„å€¼æ˜¯éªŒè¯ç å›¾ç‰‡çš„å€¼ï¼Œè€Œä¸æ˜¯requeståŒ…ä¸­çš„1234</p>
<figure data-type="image" tabindex="5"><a href="https://imgtu.com/i/7U4l0H"><img src="https://s4.ax1x.com/2022/01/17/7U4l0H.gif" alt="7U4l0H.gif" loading="lazy"></a></figure>

            </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://ja9er.github.io/RIelZKt8X/">
                  <h3 class="post-title">
                    ä»OCRåº“è”åŠ¨burpéªŒè¯ç çˆ†ç ´
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
